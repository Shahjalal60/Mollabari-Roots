<!DOCTYPE html>
<html lang="bn">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>বংশতালিকা - ট্রি ভিউ</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali:wght@400;700&display=swap">
    <style>
      body {
        font-family: 'Noto Serif Bengali', serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        color: #333;
      }

      h1 {
        font-size: 2rem;
        color: #2c3e50;
      }

      p {
        font-size: 1.1rem;
        color: #555;
      }

      .controls {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      #searchInput {
        padding: 8px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        flex: 1;
        min-width: 200px;
      }

      #searchInput:focus {
        outline: 2px solid #2980b9;
      }

      button {
        padding: 8px 16px;
        font-size: 1rem;
        border: none;
        border-radius: 4px;
        background-color: #2980b9;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      button:hover, button:focus {
        background-color: #2c3e50;
        outline: 2px solid #2980b9;
      }

      ul, #myUL {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }

      ul ul {
        position: relative;
        padding-left: 30px;
      }

      ul ul::before {
        content: '';
        position: absolute;
        top: 0;
        left: 10px;
        width: 2px;
        height: 100%;
        background: #ccc;
      }

      li {
        position: relative;
        margin: 5px 0;
      }

      .caret, .empty {
        cursor: pointer;
        user-select: none;
        font-family: 'Noto Serif Bengali', serif;
        font-size: 1rem;
        padding: 8px 12px;
        border: 1px solid;
        border-radius: 6px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        width: calc(100% - 24px);
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      .caret .icon {
        width: 16px;
        height: 16px;
        fill: #27ae60;
        transition: transform 0.3s ease;
      }

      .caret[aria-expanded="true"] .icon {
        transform: rotate(180deg);
        fill: #2980b9;
      }

      .caret:hover, .caret:focus {
        outline: 2px solid #2980b9;
      }

      .empty {
        cursor: default;
        color: #7f8c8d;
      }

      .nested {
        display: none;
        padding-left: 30px;
      }

      .active {
        display: block;
        transition: all 0.3s ease;
      }

      .highlight {
        background-color: #fff3cd !important;
        border-color: #e67e22 !important;
      }

      .level-1 .caret, .level-1 .empty {
        background-color: #e6f3ff;
        border-color: #3498db;
        color: #2c3e50;
      }

      .level-2 .caret, .level-2 .empty {
        background-color: #e8f5e9;
        border-color: #27ae60;
        color: #2c3e50;
      }

      .level-3 .caret, .level-3 .empty {
        background-color: #fffde7;
        border-color: #f1c40f;
        color: #2c3e50;
      }

      .level-4 .caret, .level-4 .empty {
        background-color: #fff5e6;
        border-color: #e67e22;
        color: #2c3e50;
      }

      .level-5 .caret, .level-5 .empty {
        background-color: #fce4ec;
        border-color: #d81b60;
        color: #2c3e50;
      }

      .level-6 .caret, .level-6 .empty {
        background-color: #f3e5f5;
        border-color: #8e24aa;
        color: #2c3e50;
      }

      .level-7 .caret, .level-7 .empty {
        background-color: #e0f7fa;
        border-color: #00acc1;
        color: #2c3e50;
      }

      li[draggable="true"] {
        cursor: move;
      }

      li.drag-over {
        border-top: 2px solid #2980b9;
      }

      @media (max-width: 600px) {
        body {
          padding: 10px;
        }

        h1 {
          font-size: 1.5rem;
        }

        p {
          font-size: 1rem;
        }

        .controls {
          flex-direction: column;
        }

        #searchInput, button {
          font-size: 0.9rem;
          padding: 6px 12px;
        }

        .caret, .empty {
          font-size: 0.9rem;
          padding: 6px 10px;
        }
      }
    </style>
  </head>
  <body>
    <h1>বংশতালিকা</h1>
    <p>এটি একটি হায়ারার্কিকাল তথ্যের ট্রি ভিউ প্রদর্শন করে। তীর চিহ্নে ক্লিক করে শাখাগুলো খুলুন বা বন্ধ করুন। ড্র্যাগ করে রিয়ারেঞ্জ করুন।</p>
    
    <div class="controls">
      <input type="text" id="searchInput" placeholder="নাম অনুসন্ধান করুন..." aria-label="ট্রি ভিউতে নাম অনুসন্ধান">
      <button id="clearSearch" aria-label="অনুসন্ধান পরিষ্কার করুন">পরিষ্কার</button>
      <button id="expandAll" aria-label="সব শাখা প্রসারণ করুন">সব প্রসারণ করুন</button>
      <button id="collapseAll" aria-label="সব শাখা সংকোচন করুন">সব সংকোচন করুন</button>
      <input type="file" id="jsonFile" accept=".json">
      <button id="loadJson" aria-label="JSON লোড করুন">JSON লোড করুন</button>
      <button id="saveJson" aria-label="JSON সেভ করুন">JSON সেভ করুন</button>
    </div>

    <ul id="myUL">
      <li class="level-1" draggable="true">
        <button class="caret" aria-expanded="false">
          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
          (১) পছু
        </button>
        <ul class="nested">
          <li class="level-2" draggable="true">
            <button class="caret" aria-expanded="false">
              <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
              (১) হানিফ (১.১)
            </button>
            <ul class="nested">
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (১) অহেদ আলী
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (১) নুরু মিয়া
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) জহর মিয়া</span></li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) মোঃ জামাল হোসাইন
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true">
                            <button class="caret" aria-expanded="false">
                              <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                              (১) শামীম আহম্মেদ
                            </button>
                            <ul class="nested">
                              <li class="level-7" draggable="true"><span class="empty">(১) আনাফ মোল্লা</span></li>
                            </ul>
                          </li>
                          <li class="level-6" draggable="true"><span class="empty">(২) মোঃ শাহ জালাল</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (৩) মোঃ জাহাঙ্গীর
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) মোঃ শাহ পরান</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) মোঃ ওয়াসিম</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) রোশন মিয়া
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মাওলান মিয়া
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নুর মোহাম্মদ</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true"><span class="empty">(২) জিয়াউর রহমান</span></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (২) জমসেদ আলী
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (১) সানাউল্লাহ মাষ্টার
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ সজল মিয়া
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) তৌহিদুর রহমান (রবিন)</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) মোঃ নিলয়</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) মোঃ কাজল
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) মোঃ আলবি রহমান</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) আঃ লতিফ
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ শরীফ মিয়া
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) তোফায়েল আহম্মেদ</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) রফিকুল ইসলাম (রোকেল)
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) হাবিবুর রহমান (হাবিব)</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) মোঃ হোসাইন</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৩) আঃ বাতেন
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) মোঃ আল আমিন</span></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (৩) আক্কেল আলী
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (১) শান্তি মিয়া
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) নাম</span></li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) আসাদ মিয়া
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ সুমন
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) তাকরিম</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) রায়হান আহম্মেদ (স্বপণ)
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) আবদুর রহমান</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৩) মজিবর রহমান
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) মোঃ সবুজ</span></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="level-2" draggable="true">
            <button class="caret" aria-expanded="false">
              <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
              (২) আলী মিয়া (১.২)
            </button>
            <ul class="nested">
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (১) আফাজ উদ্দীন
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (১) মোঃ নাজির মিয়া
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ বাদল মিয়া
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) আমির হোসেন
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) কবির মুক্তার
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ সোহেল
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) মোঃ সোরাফ
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (৩) মোঃ ছাকির
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (২) মফিজ উদ্দীন
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (১) গোলাম মোস্তফা
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) মোঃ রোবেল</span></li>
                      <li class="level-5" draggable="true"><span class="empty">(২) সোহেল মাহমুদ</span></li>
                      <li class="level-5" draggable="true"><span class="empty">(৩) মোঃ রাসেল</span></li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) আঃ খলিল
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) মোঃ রানা</span></li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৩) আঃ গাফফার
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ লিটন
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) মোঃ রিফাত</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) মোঃ হৃদয়</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) মোঃ রুহুল আমিন
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) মোঃ আব্দুল্লাহ</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true"><span class="empty">(৩) মোঃ আল আমিন</span></li>
                      <li class="level-5" draggable="true"><span class="empty">(৪) নুর আলম</span></li>
                      <li class="level-5" draggable="true"><span class="empty">(৫) মাহফুজ আলম</span></li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৪) মোঃ গিয়াসউদ্দীন
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) মোঃ নাইম</span></li>
                      <li class="level-5" draggable="true"><span class="empty">(২) ফাহিম</span></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="level-2" draggable="true">
            <button class="caret" aria-expanded="false">
              <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
              (৩) লাল মিয়া (১.৩)
            </button>
            <ul class="nested">
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (১) জিন্নাত আলী
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true"><span class="empty">(১) সোলেমান</span></li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) শিশু
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মনোহর (মনা)
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) মুজাফফর (মুজা)
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) মুক্তার</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) আক্তার</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (৩) সিরাজুল হক
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম ১</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম ২</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (২) আনছর আলী
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (১) হাজিল
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) মোঃ খোকন
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) ওয়াজেদ</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) খালেক
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) জাকির
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) মাহাবুব</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) কবির
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (৩) মাজাহারুল
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) সাব্বির</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৩) সোবাহান
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) নাম
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৪) রকমান
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (১) নাম
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম</span></li>
                        </ul>
                      </li>
                      <li class="level-5" draggable="true">
                        <button class="caret" aria-expanded="false">
                          <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                          (২) নাম
                        </button>
                        <ul class="nested">
                          <li class="level-6" draggable="true"><span class="empty">(১) নাম</span></li>
                          <li class="level-6" draggable="true"><span class="empty">(২) নাম</span></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="level-3" draggable="true">
                <button class="caret" aria-expanded="false">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                  (৩) মোনছর আলী
                </button>
                <ul class="nested">
                  <li class="level-4" draggable="true"><span class="empty">(১) হাকিম</span></li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (২) মালেক
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) মনির</span></li>
                    </ul>
                  </li>
                  <li class="level-4" draggable="true">
                    <button class="caret" aria-expanded="false">
                      <svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                      (৩) মান্নান
                    </button>
                    <ul class="nested">
                      <li class="level-5" draggable="true"><span class="empty">(১) রাসেল</span></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Initialize togglers for click and drag events
        function initializeTogglers() {
          const togglers = document.querySelectorAll('.caret');
          togglers.forEach(toggler => {
            toggler.removeEventListener('click', handleToggle);
            toggler.removeEventListener('keydown', handleKeydown);
            toggler.addEventListener('click', handleToggle);
            toggler.addEventListener('keydown', handleKeydown);
          });

          const listItems = document.querySelectorAll('#myUL li');
          listItems.forEach(li => {
            li.draggable = true;
            li.removeEventListener('dragstart', handleDragStart);
            li.removeEventListener('dragend', handleDragEnd);
            li.removeEventListener('dragover', handleDragOver);
            li.removeEventListener('dragleave', handleDragLeave);
            li.removeEventListener('drop', handleDrop);
            li.addEventListener('dragstart', handleDragStart);
            li.addEventListener('dragend', handleDragEnd);
            li.addEventListener('dragover', handleDragOver);
            li.addEventListener('dragleave', handleDragLeave);
            li.addEventListener('drop', handleDrop);
          });
        }

        // Assign level classes
        function assignLevelClasses() {
          const root = document.querySelector('#myUL');
          function setLevels(ul, level) {
            ul.querySelectorAll(':scope > li').forEach(li => {
              li.classList.remove('level-1', 'level-2', 'level-3', 'level-4', 'level-5', 'level-6', 'level-7');
              li.classList.add(`level-${level}`);
              const nestedUl = li.querySelector('ul.nested');
              if (nestedUl) {
                setLevels(nestedUl, level + 1);
              }
            });
          }
          setLevels(root, 1);
        }
        assignLevelClasses();
        initializeTogglers();

        // Toggle branch
        function handleToggle(e) {
          e.preventDefault();
          const nested = this.parentElement.querySelector('.nested');
          if (nested) {
            nested.classList.toggle('active');
            this.setAttribute('aria-expanded', nested.classList.contains('active'));
          }
        }

        function handleKeydown(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            handleToggle.call(this, e);
          }
        }

        // Drag-and-drop handlers
        function handleDragStart(e) {
          e.dataTransfer.setData('text/plain', '');
          e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
          e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
          e.preventDefault();
          e.target.closest('li').classList.add('drag-over');
        }

        function handleDragLeave(e) {
          e.target.closest('li').classList.remove('drag-over');
        }

        function handleDrop(e) {
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          const target = e.target.closest('li');
          if (dragging && dragging !== target) {
            target.parentNode.insertBefore(dragging, target.nextSibling);
            assignLevelClasses();
            initializeTogglers();
          }
          target.classList.remove('drag-over');
        }

        // Search functionality
        let searchTimeout;
        document.querySelector('#searchInput').addEventListener('input', () => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            const query = document.querySelector('#searchInput').value.trim().toLowerCase();
            searchTree(query);
          }, 300);
        });

        document.querySelector('#clearSearch').addEventListener('click', () => {
          document.querySelector('#searchInput').value = '';
          searchTree('');
        });

        function searchTree(query) {
          const allNodes = document.querySelectorAll('#myUL li');
          allNodes.forEach(node => {
            const text = node.textContent.toLowerCase();
            const isMatch = query && text.includes(query);
            node.classList.toggle('highlight', isMatch);
            if (isMatch) {
              let parent = node;
              while (parent && parent !== document.querySelector('#myUL')) {
                const parentNested = parent.querySelector('.nested');
                const parentCaret = parent.querySelector('.caret');
                if (parentNested && parentCaret) {
                  parentNested.classList.add('active');
                  parentCaret.setAttribute('aria-expanded', 'true');
                }
                parent = parent.parentElement.closest('li');
              }
            }
          });
        }

        // Expand/Collapse all
        document.querySelector('#expandAll').addEventListener('click', () => {
          document.querySelectorAll('.caret').forEach(toggler => {
            const nested = toggler.parentElement.querySelector('.nested');
            if (nested) {
              nested.classList.add('active');
              toggler.setAttribute('aria-expanded', 'true');
            }
          });
        });

        document.querySelector('#collapseAll').addEventListener('click', () => {
          document.querySelectorAll('.caret').forEach(toggler => {
            const nested = toggler.parentElement.querySelector('.nested');
            if (nested) {
              nested.classList.remove('active');
              toggler.setAttribute('aria-expanded', 'false');
            }
          });
        });

        // Load from JSON
        document.querySelector('#loadJson').addEventListener('click', () => {
          const file = document.querySelector('#jsonFile').files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              try {
                const data = JSON.parse(ev.target.result);
                buildTreeFromJson(data, document.querySelector('#myUL'));
                assignLevelClasses();
                initializeTogglers();
              } catch (error) {
                console.error('JSON parsing error:', error);
                alert('অবৈধ JSON ফাইল। অনুগ্রহ করে সঠিক ফরম্যাটে JSON ফাইল আপলোড করুন।');
              }
            };
            reader.readAsText(file);
          }
        });

        function buildTreeFromJson(data, parentUl) {
          parentUl.innerHTML = '';
          function createNode(nodeData, level) {
            const li = document.createElement('li');
            li.classList.add(`level-${level}`);
            li.draggable = true;
            if (nodeData.children && nodeData.children.length > 0) {
              const button = document.createElement('button');
              button.classList.add('caret');
              button.innerHTML = `<svg class="icon" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg> ${nodeData.name}`;
              button.setAttribute('aria-expanded', 'false');
              li.appendChild(button);
              const ul = document.createElement('ul');
              ul.classList.add('nested');
              nodeData.children.forEach(child => ul.appendChild(createNode(child, level + 1)));
              li.appendChild(ul);
            } else {
              const span = document.createElement('span');
              span.classList.add('empty');
              span.textContent = nodeData.name;
              li.appendChild(span);
            }
            return li;
          }
          parentUl.appendChild(createNode(data, 1));
        }

        // Save to JSON
        document.querySelector('#saveJson').addEventListener('click', () => {
          const jsonData = buildJsonFromTree();
          downloadJson(jsonData, 'family_tree.json');
        });

        function buildJsonFromTree() {
          const root = document.querySelector('#myUL');
          function parseNode(ul) {
            const nodes = [];
            ul.querySelectorAll(':scope > li').forEach(li => {
              const node = {};
              const caret = li.querySelector('.caret');
              const empty = li.querySelector('.empty');
              node.name = caret ? caret.textContent.trim().replace(/^[^\s]+\s/, '') : empty.textContent.trim();
              const nestedUl = li.querySelector('ul.nested');
              if (nestedUl) {
                node.children = parseNode(nestedUl);
              } else {
                node.children = [];
              }
              nodes.push(node);
            });
            return nodes;
          }
          const treeData = parseNode(root);
          return treeData[0]; // Return the root node
        }

        function downloadJson(data, filename) {
          const jsonStr = JSON.stringify(data, null, 2);
          const blob = new Blob([jsonStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      });
    </script>
  </body>
</html>